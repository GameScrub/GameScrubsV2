<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <WebPublishMethod>MSDeploy</WebPublishMethod>
    <LastUsedBuildConfiguration>Release</LastUsedBuildConfiguration>
    <LastUsedPlatform>Any CPU</LastUsedPlatform>
    
    <PublishProvider>AzureWebSite</PublishProvider>
    <MSDeployServiceURL>https://win8226.site4now.net:8172/msdeploy.axd</MSDeployServiceURL>
    <DeployIisAppPath>gamescrub-002-subsite5</DeployIisAppPath>
    <RemoteSitePhysicalPath />
    <SkipExtraFilesOnServer>True</SkipExtraFilesOnServer>
    <MSDeployPublishMethod>WMSVC</MSDeployPublishMethod>
    <EnableMSDeployBackup>True</EnableMSDeployBackup>
    <EnableMsDeployAppOffline>True</EnableMsDeployAppOffline>
    <UserName>gamescrub-002</UserName>
    <_SavePWD>False</_SavePWD>
    
    <TargetFramework>net10.0</TargetFramework>
    <SelfContained>true</SelfContained>
    <RuntimeIdentifier>win-x86</RuntimeIdentifier>
    <PublishSingleFile>false</PublishSingleFile>
    <PublishTrimmed>false</PublishTrimmed>
    
    <EnvironmentName>Production</EnvironmentName>
    <LaunchSiteAfterPublish>True</LaunchSiteAfterPublish>
    <SiteUrlToLaunchAfterPublish>http://minimal-api.gamescrubs.com/</SiteUrlToLaunchAfterPublish>
  </PropertyGroup>
  
  <!-- Custom target in publish profile - NO NESTED <Project> TAG -->
  <Target Name="ForceWebConfigReplace" AfterTargets="Publish">
    <Message Text="!!!!!!! REPLACING WEB.CONFIG !!!!!!!" Importance="high" />
    
    <PropertyGroup>
      <FixedWebConfig><![CDATA[<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <location path="." inheritInChildApplications="false">
    <system.webServer>
      <handlers>
        <add name="aspNetCore" path="*" verb="*" modules="AspNetCoreModuleV2" resourceType="Unspecified" />
      </handlers>
      <aspNetCore processPath=".\GameScrubsV2.exe" 
                  stdoutLogEnabled="true" 
                  stdoutLogFile=".\logs\stdout" 
                  hostingModel="inprocess">
        <environmentVariables>
          <environmentVariable name="ASPNETCORE_ENVIRONMENT" value="Production" />
        </environmentVariables>
      </aspNetCore>
    </system.webServer>
  </location>
</configuration>]]></FixedWebConfig>
    </PropertyGroup>
    
    <WriteLinesToFile
      File="$(PublishDir)web.config"
      Lines="$(FixedWebConfig)"
      Overwrite="true" />
      
    <Message Text="!!!!!!! WEB.CONFIG REPLACED !!!!!!!" Importance="high" />
  </Target>
</Project>